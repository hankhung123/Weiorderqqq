<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>訂餐系統</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: 'Arial', sans-serif;
  background: #f5f6fa;
  margin: 0;
  padding: 20px;
}
h1 {
  text-align: center;
  color: #2f3640;
}

/* 表單 */
form {
  background: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  max-width: 500px;
  margin: 0 auto 30px;
  transition: transform 0.3s;
}
form:hover { transform: translateY(-3px); }
form label {
  display: inline-block;
  width: 80px;
  font-weight: bold;
  color: #2f3640;
}
form input, form select, form button {
  margin: 5px 0;
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}
form input, form select { width: calc(100% - 100px); }
form button {
  background: linear-gradient(90deg,#00a8ff,#0097e6);
  color: #fff;
  border: none;
  cursor: pointer;
  width: 100%;
  transition: 0.3s;
}
form button:hover { background: linear-gradient(90deg,#0097e6,#00a8ff); transform: scale(1.02); }

/* 表格 */
.orders { overflow-x: auto; }
table {
  width: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}
th, td {
  padding: 10px;
  text-align: center;
  border-bottom: 1px solid #eee;
  word-wrap: break-word;
}
th {
  background: #00a8ff;
  color: #fff;
  position: sticky;
  top: 0;
}
tr:nth-child(even) { background: #f0f8ff; } /* 漸層列 */
tr:nth-child(odd) { background: #ffffff; }
tr:hover { background: #d1ecff; }

/* 下拉選單 & 按鈕 */
td select { width: 90%; padding: 4px 6px; border-radius: 6px; border: 1px solid #ccc; transition: all 0.2s; }
td select:hover { border-color: #00a8ff; }
td button {
  background: #e84118;
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}
td button:hover { background: #c23616; transform: scale(1.05); }

/* 提示訊息 */
#message {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #00a8ff;
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  display: none;
  z-index: 999;
  opacity: 0;
  transition: opacity 0.5s ease;
}

/* 響應式 */
@media (max-width: 600px) {
  form label { width: 100%; margin-top: 10px; }
  form input, form select { width: 100%; }
  form button { margin-top: 15px; }
  td:nth-child(1), td:nth-child(2), td:nth-child(3),
  td:nth-child(4), td:nth-child(5), td:nth-child(6),
  td:nth-child(7), td:nth-child(8) { min-width: 100px; }
}
</style>
</head>
<body>
<h1>訂餐系統</h1>

<form id="orderForm">
  <label>取餐日:</label><input type="date" id="date" required><br>
  <label>姓名:</label><input type="text" id="name" required><br>
  <label>數量:</label><input type="number" step="0.1" id="quantity" required><br>
  <label>電話:</label><input type="text" id="phone" pattern="^[0-9]+$" required><br>
  <label>備註:</label><input type="text" id="note" placeholder="可留空"><br>
  <label>餐點:</label>
  <select id="menu" required>
    <option value="甘蔗雞">甘蔗雞</option>
    <option value="鹹水雞">鹹水雞</option>
    <option value="烤雞">烤雞</option>
    <option value="滷味">滷味</option>
  </select><br>
  <button type="submit">送出訂單</button>
</form>

<div class="orders">
  <h2>訂單列表</h2>
  <table id="ordersTable">
    <thead>
      <tr>
        <th>取餐日</th>
        <th>姓名</th>
        <th>數量</th>
        <th>電話</th>
        <th>備註</th>
        <th>取餐狀態</th>
        <th>餐點</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div id="message"></div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxuiGYNCL76-z5GpHxh3CRCuZQL0G2YK6EOjfAwUzbZpVOdemJMZjkCcwcHHQYvO5bn/exec";

function showMessage(text,color="#00a8ff"){
  const msg=document.getElementById("message");
  msg.innerText=text;
  msg.style.background=color;
  msg.style.display="block";
  msg.style.opacity="1";
  setTimeout(()=>{ msg.style.opacity="0"; setTimeout(()=>{msg.style.display="none";},500); },2000);
}

async function loadOrders(){
  const res=await fetch(API_URL);
  const data=await res.json();
  const tbody=document.querySelector("#ordersTable tbody");
  tbody.innerHTML="";
  data.forEach((order,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${order.取餐日}</td>
      <td>${order.姓名}</td>
      <td>${order.數量}</td>
      <td>${order.電話}</td>
      <td>${order.備註||""}</td>
      <td>
        <select onchange="updateStatus(${i}, this.value)">
          <option value="未取餐" ${order.取餐狀態==="未取餐"?"selected":""}>未取餐</option>
          <option value="已取餐" ${order.取餐狀態==="已取餐"?"selected":""}>已取餐</option>
        </select>
      </td>
      <td>${order.餐點}</td>
      <td><button onclick="deleteOrder(${i})">刪除</button></td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById("orderForm").addEventListener("submit",async(e)=>{
  e.preventDefault();
  const order={
    date:document.getElementById("date").value,
    name:document.getElementById("name").value,
    quantity:document.getElementById("quantity").value,
    phone:document.getElementById("phone").value.replace(/^0/,""),
    note:document.getElementById("note").value,
    menu:document.getElementById("menu").value
  };
  const res=await fetch(API_URL,{method:"POST",body:JSON.stringify(order)});
  showMessage(await res.text());
  loadOrders();
  e.target.reset();
});

async function deleteOrder(index){
  if(!confirm("確定要刪除這筆訂單嗎？")) return;
  const res=await fetch(`${API_URL}?delete=${index}`,{method:"POST"});
  showMessage(await res.text(),"#e84118");
  loadOrders();
}

async function updateStatus(index,status){
  const res=await fetch(`${API_URL}?updateStatus=${index}&status=${encodeURIComponent(status)}`,{method:"POST"});
  showMessage(await res.text(),"#44bd32");
  loadOrders();
}

loadOrders();
</script>
</body>
</html>